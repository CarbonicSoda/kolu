(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))f(c);new MutationObserver(c=>{for(const a of c)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&f(d)}).observe(document,{childList:!0,subtree:!0});function u(c){const a={};return c.integrity&&(a.integrity=c.integrity),c.referrerPolicy&&(a.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?a.credentials="include":c.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function f(c){if(c.ep)return;c.ep=!0;const a=u(c);fetch(c.href,a)}})();class C{canvas;alpha;desync;context;constructor(o,u){this.canvas=o??document.createElement("canvas"),this.alpha=!u?.solidbg,this.desync=!!u?.desync,this.context=this.canvas.getContext("2d",{alpha:this.alpha,desynchronized:this.desync})}}const M=s=>Math.PI*s/180;var h;(s=>{function o(e,i){console.log(`${i??""}${i?" ~ ":""}vec(${e.length}) ${JSON.stringify(e)}`)}s.log=o;function u(e,i){return e.map((t,n)=>t+i[n])}s.vAdd=u;function f(e,i){return e.map((t,n)=>t-i[n])}s.vSub=f;function c(e,i){let t=0;for(let n=0;n<e.length;n++)t+=e[n]*i[n];return t}s.dot=c;function a(e,i){const[t,n,r]=e,[l,m,x]=i;return[n*x-r*m,r*l-t*x,t*m-n*l]}s.cross=a;function d(e,i){return e.map(t=>t+i)}s.add=d;function p(e,i){return d(e,-i)}s.sub=p;function v(e,i){return e.map(t=>t*i)}s.mul=v;function b(e,i){return v(e,1/i)}s.div=b;function w(e){return c(e,e)**.5}s.norm=w;function A(e){return b(e,w(e))}s.unit=A;function j(e){return e.concat(1)}s.homo=j;function T(e){return b(e.slice(0,-1),e.at(-1))}s.unhomo=T})(h||(h={}));var y;(s=>{function o(t,n){console.log(`${n??""}${n?" ~ ":""}mat(${t.length}x${t.length})
[${t.map(r=>JSON.stringify(r)).join(`
 `)}]`)}s.log=o;function u(t){return[...Array(t)].map(()=>Array(t).fill(0))}s.zero=u;function f(t){const n=u(t);for(let r=0;r<t;r++)n[r][r]=1;return n}s.id=f;function c(t,n){n?.deg&&(t=t.map(M));const[r,l,m]=t.map(Math.sin),[x,O,S]=t.map(Math.cos),L=[[x,-r,0],[r,x,0],[0,0,1]],F=[[O,0,l],[0,1,0],[-l,0,O]],R=[[1,0,0],[0,S,-m],[0,m,S]];return v(R,v(F,L))}s.rot=c;function a(t,n){return t.map(r=>r[n])}s.colAt=a;function d(t,n){return t.map((r,l)=>h.vAdd(r,n[l]))}s.mAdd=d;function p(t,n){return t.map((r,l)=>h.vSub(r,n[l]))}s.mSub=p;function v(t,n){const r=u(t.length);for(let l=0;l<t.length;l++)for(let m=0;m<n.length;m++)r[l][m]=h.dot(t[l],a(n,m));return r}s.mMul=v;function b(t,n){return t.map(r=>h.add(r,n))}s.add=b;function w(t,n){return b(t,-n)}s.sub=w;function A(t,n){return t.map(r=>h.mul(r,n))}s.mul=A;function j(t,n){return A(t,1/n)}s.div=j;function T(t,n=[0,0,0],r=[0,0,0,1]){return t.map((l,m)=>l.concat(n[m])).concat([r])}s.homo=T;function e(t,n){return t.map(r=>h.dot(r,n))}s.transform=e;function i(t,n){return h.unhomo(e(t,h.homo(n)))}s.transformHomo=i})(y||(y={}));class E{constructor(o=[0,0,0],u=[0,0,0],f=Math.PI/2){this.pos=o,this.rot=u,this.fov=f}setRot(o){this.rot=o.map(M)}setAxisRot(o,u){this.rot[o]=M(u)}setFOV(o){this.fov=M(o)}}class H{constructor(o=new E){this.cam=o}trigs=[];objs=[];putTri(o){return this.trigs.push(o)-1}putObj(o){return this.objs.push(o)-1}rmTri(o){this.trigs[o]=null}rmObj(o){this.objs[o]=null}render(o,u){this.trigs=this.trigs.filter(n=>n),this.objs=this.objs.filter(n=>n);const f=o.canvas,c=o.context,a=f.width,d=f.height,p=this.cam,v=y.rot(p.rot),b=y.homo(v,y.transform(v,h.mul(p.pos,-1))),w=2*Math.tan(.5*p.fov)/d,A=[[1,0,0,0],[0,1,0,0],[0,0,0,-1],[0,0,w,0]],j=y.mMul(A,b),T=this.objs.flatMap(n=>n.getTrigs()),e=[];for(const n of this.trigs.concat(T)){const r=n.vertices.map(m=>y.transformHomo(j,m)),l=Math.min(...r.map(m=>m[2]));l<0||e.push({projected:r,z:l,fill:n.fill})}c.clearRect(0,0,a,d);const i=Math.round(.5*a),t=Math.round(.5*d);for(const n of e.sort(({z:r},{z:l})=>r-l)){let[[r,l],[m,x],[O,S]]=n.projected;if(u?.round&&([r,m,O,l,x,S]=[r,m,O,l,x,S].map(Math.round)),c.beginPath(),c.moveTo(i+r,t-l),c.lineTo(i+m,t-x),c.lineTo(i+O,t-S),u?.wireframe){c.lineTo(i+r,t-l),c.stroke();continue}c.fillStyle=n.fill,c.fill()}}}class z{constructor(o,u="green"){this.vertices=o,this.fill=u}}class N{constructor(o,u=[0,0,0],f=[0,0,0],c=y.id(4)){this.trigs=o,this.offset=u,this.origin=f,this.transform=c}setTransform(o){this.transform=o.length===3?y.homo(o):o}getTrigs(){return this.trigs.map(o=>new z(o.vertices.map(u=>{const f=h.vSub(u,this.origin),c=y.transformHomo(this.transform,f);return h.vAdd(h.vAdd(c,this.origin),this.offset)}),o.fill))}}function P(s,o,u,f,c=d=>+d,a=(d,p)=>+d*p){c(s)<u||(f(s),requestAnimationFrame(()=>P(a(s,o),o,u,f,c,a)))}const g={solidbg:!1,desync:!0,wireframe:!1,round:!1,xsens:1.5,ysens:1,mvdist:100,mvdecay:.97,cubecnt:20,cubealpha:1},$=document.getElementById("canvas3d"),I=()=>{const s=$.height=window.innerHeight,o=$.width=window.innerWidth,u=new C($,g),f=new H,c=()=>f.render(u,g),a=(e,i,t,n)=>new z([e,i,t].map(r=>r.split("").map(l=>+l?o:0)),`rgba(${n},${g.cubealpha})`),d=[a("001","101","011","255,0,0"),a("011","101","111","255,0,0"),a("000","100","101","0,0,255"),a("000","001","101","0,0,255"),a("010","000","001","255,255,0"),a("010","011","001","255,255,0")],p=[];for(let e=0;e<g.cubecnt;e++){const i=e-g.cubecnt/2,t=new N(d,[i*o*3,-Math.abs(i)*o,-o*10],[o/2,o/2,o/2]);p.push(t),f.putObj(t)}const v=[],b=[],w=[];for(let e=0;e<g.cubecnt;e++)v.push((Math.random()+1)*10),b.push(Math.random()),w.push(Math.random());const A=(e=0)=>{for(let i=0;i<p.length;i++){const t=e/v[i];p[i].setTransform(y.rot([t*b[i],t*w[i],0],{deg:!0}))}requestAnimationFrame(A)};A(),$.onmousemove=e=>{f.cam.setAxisRot(1,(e.offsetX/o-.5)*360*g.xsens),f.cam.setAxisRot(2,Math.min((e.offsetY/s-.5)*85*g.ysens,85))},$.onkeydown=e=>{const i=e.key.toLowerCase();switch(i){case"i":{P(.001*Math.PI,.97,.001,n=>f.cam.fov-=n);return}case"o":{P(.001*Math.PI,.97,.001,n=>f.cam.fov+=n);return}}const t=[0,0,0];switch(i){case"w":t[2]=g.mvdist;break;case"s":t[2]=-g.mvdist;break;case"d":t[0]=g.mvdist;break;case"a":t[0]=-g.mvdist;break}P(t,g.mvdecay,1,n=>f.cam.pos=h.vAdd(f.cam.pos,n),h.norm,h.mul)};let j=0;setInterval(()=>{console.clear(),console.log("fps",j),j=0},1e3);let T;(T=()=>{c(),j++,requestAnimationFrame(T)})()};window.addEventListener("resize",I);I();
