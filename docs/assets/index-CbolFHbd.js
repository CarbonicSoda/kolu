(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))l(c);new MutationObserver(c=>{for(const f of c)if(f.type==="childList")for(const d of f.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function a(c){const f={};return c.integrity&&(f.integrity=c.integrity),c.referrerPolicy&&(f.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?f.credentials="include":c.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function l(c){if(c.ep)return;c.ep=!0;const f=a(c);fetch(c.href,f)}})();class C{canvas;alpha;desync;context;constructor(o,a){this.canvas=o??document.createElement("canvas"),this.alpha=!a?.solidbg,this.desync=!!a?.desync,this.context=this.canvas.getContext("2d",{alpha:this.alpha,desynchronized:this.desync})}}const M=s=>Math.PI*s/180;var h;(s=>{function o(e,i){console.log(`${i??""}${i?" ~ ":""}vec(${e.length}) ${JSON.stringify(e)}`)}s.log=o;function a(e,i){return e.map((t,n)=>t+i[n])}s.vAdd=a;function l(e,i){return e.map((t,n)=>t-i[n])}s.vSub=l;function c(e,i){let t=0;for(let n=0;n<e.length;n++)t+=e[n]*i[n];return t}s.dot=c;function f(e,i){const[t,n,r]=e,[u,m,x]=i;return[n*x-r*m,r*u-t*x,t*m-n*u]}s.cross=f;function d(e,i){return e.map(t=>t+i)}s.add=d;function p(e,i){return d(e,-i)}s.sub=p;function b(e,i){return e.map(t=>t*i)}s.mul=b;function v(e,i){return b(e,1/i)}s.div=v;function w(e){return c(e,e)**.5}s.norm=w;function A(e){return v(e,w(e))}s.unit=A;function j(e){return e.concat(1)}s.homo=j;function S(e){return v(e.slice(0,-1),e.at(-1))}s.unhomo=S})(h||(h={}));var y;(s=>{function o(t,n){console.log(`${n??""}${n?" ~ ":""}mat(${t.length}x${t.length})
[${t.map(r=>JSON.stringify(r)).join(`
 `)}]`)}s.log=o;function a(t){return[...Array(t)].map(()=>Array(t).fill(0))}s.zero=a;function l(t){const n=a(t);for(let r=0;r<t;r++)n[r][r]=1;return n}s.id=l;function c(t,n){n?.deg&&(t=t.map(M));const[r,u,m]=t.map(Math.sin),[x,T,O]=t.map(Math.cos),L=[[x,-r,0],[r,x,0],[0,0,1]],F=[[T,0,u],[0,1,0],[-u,0,T]],R=[[1,0,0],[0,O,-m],[0,m,O]];return b(R,b(F,L))}s.rot=c;function f(t,n){return t.map(r=>r[n])}s.colAt=f;function d(t,n){return t.map((r,u)=>h.vAdd(r,n[u]))}s.mAdd=d;function p(t,n){return t.map((r,u)=>h.vSub(r,n[u]))}s.mSub=p;function b(t,n){const r=a(t.length);for(let u=0;u<t.length;u++)for(let m=0;m<n.length;m++)r[u][m]=h.dot(t[u],f(n,m));return r}s.mMul=b;function v(t,n){return t.map(r=>h.add(r,n))}s.add=v;function w(t,n){return v(t,-n)}s.sub=w;function A(t,n){return t.map(r=>h.mul(r,n))}s.mul=A;function j(t,n){return A(t,1/n)}s.div=j;function S(t,n=[0,0,0],r=[0,0,0,1]){return t.map((u,m)=>u.concat(n[m])).concat([r])}s.homo=S;function e(t,n){return t.map(r=>h.dot(r,n))}s.transform=e;function i(t,n){return h.unhomo(e(t,h.homo(n)))}s.transformHomo=i})(y||(y={}));class E{constructor(o=[0,0,0],a=[0,0,0],l=Math.PI/2){this.pos=o,this.rot=a,this.fov=l}setRot(o){this.rot=o.map(M)}setAxisRot(o,a){this.rot[o]=M(a)}setFOV(o){this.fov=M(o)}}class H{constructor(o=new E){this.cam=o}trigs=[];objs=[];putTri(o){return this.trigs.push(o)-1}putObj(o){return this.objs.push(o)-1}rmTri(o){this.trigs[o]=null}rmObj(o){this.objs[o]=null}render(o,a){this.trigs=this.trigs.filter(n=>n),this.objs=this.objs.filter(n=>n);const l=o.canvas,c=o.context,f=l.width,d=l.height,p=this.cam,b=y.rot(p.rot),v=y.homo(b,y.transform(b,h.mul(p.pos,-1))),w=2*Math.tan(.5*p.fov)/d,A=[[1,0,0,0],[0,1,0,0],[0,0,0,-1],[0,0,w,0]],j=y.mMul(A,v),S=this.objs.flatMap(n=>n.getTrigs()),e=[];for(const n of this.trigs.concat(S)){const r=n.vertices.map(m=>y.transformHomo(j,m)),u=Math.min(...r.map(m=>m[2]));u<0||e.push({projected:r,z:u,fill:n.fill})}c.clearRect(0,0,f,d);const i=Math.round(.5*f),t=Math.round(.5*d);for(const n of e.sort(({z:r},{z:u})=>r-u)){let[[r,u],[m,x],[T,O]]=n.projected;if(a?.round&&([r,m,T,u,x,O]=[r,m,T,u,x,O].map(Math.round)),c.beginPath(),c.moveTo(i+r,t-u),c.lineTo(i+m,t-x),c.lineTo(i+T,t-O),a?.wireframe){c.lineTo(i+r,t-u),c.stroke();continue}c.fillStyle=n.fill,c.fill()}}}class z{constructor(o,a="green"){this.vertices=o,this.fill=a}}class N{constructor(o,a=[0,0,0],l=[0,0,0],c=y.id(4)){this.trigs=o,this.offset=a,this.origin=l,this.transform=c}setTransform(o){this.transform=o.length===3?y.homo(o):o}getTrigs(){return this.trigs.map(o=>new z(o.vertices.map(a=>{const l=h.vSub(a,this.origin),c=y.transformHomo(this.transform,l);return h.vAdd(h.vAdd(c,this.origin),this.offset)}),o.fill))}}function P(s,o,a,l,c=d=>+d,f=(d,p)=>+d*p){c(s)<a||(l(s),requestAnimationFrame(()=>P(f(s,o),o,a,l,c,f)))}const g={solidbg:!1,desync:!0,wireframe:!1,round:!1,xsens:1.5,ysens:1,mvdist:100,mvdecay:.97,cubecnt:15,cubealpha:1},$=document.getElementById("canvas3d"),I=()=>{const s=$.height=window.innerHeight,o=$.width=window.innerWidth,a=new C($,g),l=new H,c=()=>l.render(a,g),f=(e,i,t,n)=>new z([e,i,t].map(r=>r.split("").map(u=>+u?o:0)),`rgba(${n},${g.cubealpha})`),d=[f("001","101","011","255,0,0"),f("011","101","111","255,0,0"),f("010","000","001","0,0,255"),f("010","011","001","0,0,255")],p=[];for(let e=0;e<g.cubecnt;e++){const i=e-g.cubecnt/2,t=new N(d,[i*o*3,-Math.abs(i)*o,-o*10],[o/2,o/2,o/2]);p.push(t),l.putObj(t)}const b=[],v=[],w=[];for(let e=0;e<g.cubecnt;e++)b.push((Math.random()+1)*10),v.push(Math.random()),w.push(Math.random());const A=(e=0)=>{for(let i=0;i<p.length;i++){const t=e/b[i];p[i].setTransform(y.rot([t*v[i],t*w[i],0],{deg:!0}))}requestAnimationFrame(A)};A(),$.onmousemove=e=>{l.cam.setAxisRot(1,(e.offsetX/o-.5)*360*g.xsens),l.cam.setAxisRot(2,Math.min((e.offsetY/s-.5)*85*g.ysens,85))},$.onkeydown=e=>{const i=e.key.toLowerCase();switch(i){case"i":{P(.001*Math.PI,.97,.001,n=>l.cam.fov-=n);return}case"o":{P(.001*Math.PI,.97,.001,n=>l.cam.fov+=n);return}}const t=[0,0,0];switch(i){case"w":{t[2]=g.mvdist;break}case"s":{t[2]=-g.mvdist;break}case"d":{t[0]=g.mvdist;break}case"a":{t[0]=-g.mvdist;break}}P(t,g.mvdecay,1,n=>l.cam.pos=h.vSub(l.cam.pos,n),h.norm,h.mul)};let j=0;setInterval(()=>{console.clear(),console.log("fps",j),j=0},1e3);let S;(S=()=>{c(),j++,requestAnimationFrame(S)})()};window.addEventListener("resize",I);I();
