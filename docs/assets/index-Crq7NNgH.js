(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();class n{constructor(t,e=t.length){this.vec=t,this.dim=e}toString(){return`Vec<${this.dim.toFixed()}> (${this.vec.map(t=>t.toFixed(2)).join(", ")})`}map(t){return new n(this.vec.map(t))}get x(){return this.vec[0]}get y(){return this.vec[1]}get z(){return this.vec[2]}static fill(t,e){return new n(Array(t).fill(e))}static zero(t){return this.fill(t,0)}static id(t,e){const r=Array(t).fill(0);return r[e]=1,new n(r)}vAdd(t){return this.map((e,r)=>e+t.vec[r])}vSub(t){return this.map((e,r)=>e-t.vec[r])}neg(){return this.map(t=>-t)}add(t){return this.map(e=>e+t)}sub(t){return this.add(-t)}mul(t){return this.map(e=>e*t)}div(t){return this.mul(1/t)}dot(t){let e=0;for(let r=0;r<this.dim;r++)e+=this.vec[r]*t.vec[r];return e}norm(){return this.dot(this)}homo(){return new n(this.vec.concat(1))}unhomo(){return new n(this.vec.slice(0,3)).div(this.vec[3])}}class ${constructor(t=n.zero(3),e=n.zero(3),r=90){this.position=t,this.rotation=e,this.fov=r}}class N{next=0;modelStore=new Map;get models(){return Array.from(this.modelStore.values())}push(t){return this.modelStore.set(this.next,t),this.next++}remove(t){return this.modelStore.delete(t)}}class c{constructor(t,e=t.length){this.mat=t,this.dim=e}toString(){const t=[];for(let e=0;e<this.dim;e++)t[e]=Math.max(...this.col(e).vec.map(r=>r.toFixed(2).length));return`Mat<${this.dim.toFixed()}>
[${this.mat.map(e=>e.map((r,o)=>r.toFixed(2).padStart(t[o])).join(", ")).join(`
 `)}]`}map(t){return new c(this.mat.map((e,r)=>t(new n(e),r).vec))}vmap(t){return new n(this.mat.map((e,r)=>t(new n(e),r)))}row(t){return new n(this.mat[t])}col(t){return new n(this.mat.map(e=>e[t]))}static zero(t){return new c(Array(t).fill(n.zero(t).vec))}static id(t){const e=[];for(let r=0;r<t;r++)e.push(n.id(t,r).vec);return new c(e)}static rot(t,e=!1){const[r,o,i]=t.map(l=>Math.sin(e?l*Math.PI/180:l)).vec,[a,d,w]=t.map(l=>Math.cos(e?l*Math.PI/180:l)).vec,A=new c([[1,0,0],[0,d,-o],[0,o,d]]),F=new c([[a,0,r],[0,1,0],[-r,0,a]]);return new c([[w,-i,0],[i,w,0],[0,0,1]]).mMul(F).mMul(A)}mAdd(t){return this.map((e,r)=>e.vAdd(t.row(r)))}mSub(t){return this.map((e,r)=>e.vSub(t.row(r)))}mMul(t){const e=[];for(let r=0;r<this.dim;r++){e[r]=[];for(let o=0;o<this.dim;o++)e[r][o]=this.row(r).dot(t.col(o))}return new c(e)}add(t){return this.map(e=>e.add(t))}sub(t){return this.add(-t)}mul(t){return this.map(e=>e.mul(t))}div(t){return this.mul(1/t)}apply(t){return this.vmap(e=>e.dot(t))}homo(t=n.zero(3),e=n.id(4,3)){return new c(this.mat.map((r,o)=>r.concat(t.vec[o])).concat([e.vec]))}homopply(t){return this.apply(t.homo()).unhomo()}}class z{constructor(t,e="black"){this.vertices=t,this.color=e}worldspace(t,e,r){const o=this.vertices.map(i=>{const a=i.vSub(t);return r.homopply(a).vAdd(e)});return new z(o,this.color)}eyespace(t,e){const r=this.vertices.map(o=>c.rot(e.neg(),!0).apply(o.vSub(t)));return new z(r,this.color)}}class T{constructor(t,e=n.zero(3),r=n.zero(3),o=c.id(4)){this.meshes=t,this.origin=e,this.offset=r,this.matrix=o.dim===3?o.homo():o}matrix;set transform(t){this.matrix=t.dim===3?t.homo():t}get transform(){return this.matrix}get worldspace(){return this.meshes.map(t=>t.worldspace(this.origin,this.offset,this.transform))}}class X{constructor(t,e,r=t.getContext("2d",e)){this.canvas=t,this.context=r}render(t,e,r){if(!this.context)throw new Error("missing canvas context");const{width:o,height:i}=this.canvas,a=.5*o,d=.5*i,w=.5*o/Math.tan(e.fov*Math.PI/360),A=new c([[w/a,0,0],[0,w/d,0],[0,0,-1]]).homo(new n([0,0,-2*w]),new n([0,0,-1,0])),F=t.models.flatMap(m=>m.worldspace.map(p=>p.eyespace(e.position,e.rotation))),S=[];for(const{vertices:m,color:p}of F){const g=m.map(v=>A.homopply(v)),x=Math.max(...g.map(v=>v.z));Math.abs(x)>1||S.push({ndcs:g,color:p,maxz:x})}S.sort((m,p)=>p.maxz-m.maxz),this.context.clearRect(0,0,o,i);const l=Math.round(.5*o),q=Math.round(.5*i);for(const{ndcs:m,color:p}of S){this.context.beginPath();const g=(m[0].x+1)*l,x=(1-m[0].y)*q;this.context.moveTo(g,x);for(const v of m.slice(1))this.context.lineTo((v.x+1)*l,(1-v.y)*q);if(r?.wireframe){this.context.lineTo(g,x),this.context.stroke();continue}this.context.fillStyle=p,this.context.fill()}}}function M(s,t,e,r){s!==void 0&&(e(s),requestAnimationFrame(()=>{M(r(s,t),t,e,r)}))}const u={alpha:!0,colorSpace:"srgb",desynchronized:!0,willReadFrequently:!1,wireframe:!1,modelCount:7,modelWidth:1e3},L=new N,f=new $,b=new X(document.getElementById("canvas"),u),O=document.documentElement.clientWidth,j=document.documentElement.clientHeight;b.canvas.width=O;b.canvas.height=j;function Z(){b.render(L,f,u)}function y(s,t,e,r,o){const i=[s,t,e,r].map(a=>new n(a.split("").map(d=>+d*u.modelWidth)));return new z(i,o)}const k=[y("001","011","111","101","hsl(120, 100%, 50%)"),y("000","010","110","100","hsl(270, 100%, 50%)"),y("010","011","111","110","hsl(210, 100%, 50%)"),y("000","001","101","100","hsl(30, 100%, 50%)"),y("000","010","011","001","hsl(0, 100%, 50%)"),y("100","110","111","101","hsl(180, 100%, 50%)")],E=[],P=u.modelCount,h=u.modelWidth,C=.5*h;for(let s=0;s<P;s++){const t=s-.5*P,e=new T(k,new n([C,C,C]),new n([2*t*h,(Math.abs(t)-.25*P)*h,-10*h]));L.push(e),E.push(e)}const I=[],W=[];for(let s=0;s<u.modelCount;s++)I.push(Math.random()),W.push(Math.random());function Y(s=0){for(let t=0;t<u.modelCount;t++){const e=s/1e3;E[t].transform=c.rot(new n([e*I[t],e*W[t],0]))}requestAnimationFrame(Y)}Y();b.canvas.onmousemove=s=>{f.rotation=new n([(s.offsetX/O-.5)*180,(s.offsetY/j-.5)*90,0])};b.canvas.onkeydown=s=>{const t=s.key.toLowerCase(),e=r=>{M(r,.95,o=>{f.position=f.position.vSub(c.rot(f.rotation,!0).apply(o))},(o,i)=>o.norm()<.1?void 0:o.mul(i))};switch(t){case"f":{u.wireframe=!u.wireframe;return}case"i":{M(1,.95,r=>f.fov-=r,(r,o)=>r<.1?void 0:r*o);return}case"o":{M(1,.95,r=>f.fov+=r,(r,o)=>r<.1?void 0:r*o);return}case"w":{e(new n([0,0,h*.1]));return}case"s":{e(new n([0,0,-h*.1]));return}case"a":{e(new n([h*.1,0,0]));return}case"d":{e(new n([-h*.1,0,0]));return}case"q":{e(new n([0,h*.1,0]));return}case"e":{e(new n([0,-h*.1,0]));return}}};function R(){Z(),requestAnimationFrame(R)}R();
