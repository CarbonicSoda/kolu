<!-- FOR TESTING PURPOSE -->
<!-- CODE IS GARBAGE, ONLY FOR TESTING -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>test</title>
		<script>
			function print(obj) {
				console.log(JSON.stringify(obj));
			}
		</script>
		<style>
			canvas {
				background-color: whitesmoke;
			}
		</style>
	</head>
	<body>
		<canvas id="canvas3d" tabindex="1"></canvas>
		<script type="module">
			import * as Kolu from "./src/index";

			const WIREFRAME = true;
			const NOALPHA = false;
			const DIST = 50;
			const DECAY = 0.85;
			const CUBECNT = 10;
			const DISP = 10;

			const cvs = document.getElementById("canvas3d");
			cvs.width = window.innerWidth;
			cvs.height = window.innerHeight;

			const kcvs = new Kolu.Cvs(cvs, { noAlpha: NOALPHA });
			const scene = new Kolu.Scene();
			const render = () => scene.render(kcvs, { wireframe: WIREFRAME });

			const w = cvs.width * 0.3;
			const cubeTrigs = [
				//top
				new Kolu.Tri(
					[
						[0, 0, w],
						[w, 0, w],
						[0, w, w],
					],
					"red",
				),
				new Kolu.Tri(
					[
						[0, w, w],
						[w, 0, w],
						[w, w, w],
					],
					"red",
				),

				//bottom
				new Kolu.Tri(
					[
						[0, 0, 0],
						[w, 0, 0],
						[w, w, 0],
					],
					"green",
				),
				new Kolu.Tri(
					[
						[0, 0, 0],
						[0, w, 0],
						[w, w, 0],
					],
					"green",
				),

				//front
				new Kolu.Tri(
					[
						[0, 0, 0],
						[w, 0, 0],
						[w, 0, w],
					],
					"blue",
				),
				new Kolu.Tri(
					[
						[0, 0, 0],
						[0, 0, w],
						[w, 0, w],
					],
					"blue",
				),

				//back
				new Kolu.Tri(
					[
						[0, w, 0],
						[w, w, 0],
						[0, w, w],
					],
					"black",
				),
				new Kolu.Tri(
					[
						[w, w, 0],
						[0, w, w],
						[w, w, w],
					],
					"black",
				),

				//left
				new Kolu.Tri(
					[
						[0, w, 0],
						[0, 0, 0],
						[0, 0, w],
					],
					"yellow",
				),
				new Kolu.Tri(
					[
						[0, w, 0],
						[0, w, w],
						[0, 0, w],
					],
					"yellow",
				),

				//right
				new Kolu.Tri(
					[
						[w, 0, 0],
						[w, w, 0],
						[w, w, w],
					],
					"purple",
				),
				new Kolu.Tri(
					[
						[w, 0, 0],
						[w, 0, w],
						[w, w, w],
					],
					"purple",
				),
			];

			const cubes = [];
			for (let i = 0; i < CUBECNT; i++) {
				cubes.push(
					new Kolu.Obj(
						cubeTrigs,
						[
							(Math.random() - 0.5) * DISP * w,
							(Math.random() - 0.5) * DISP * w,
							(Math.random() - 0.5) * DISP * w,
						],
						[w / 2, w / 2, w / 2],
					),
				);
			}
			for (const cube of cubes) scene.putObj(cube);

			cvs.onmousemove = (ev) => {
				// MO FIX GIMBOL LOCK
				scene.cam.setAxisRot(1, (ev.offsetX / cvs.width - 0.5) * 180 * 2);
				scene.cam.setAxisRot(2, (ev.offsetY / cvs.height - 0.5) * 180);
			};

			cvs.onkeydown = (ev) => {
				const key = ev.key.toLowerCase();
				const mv = [0, 0, 0];
				switch (key) {
					case "w":
						mv[2] = -DIST;
						break;
					case "s":
						mv[2] = DIST;
						break;
					case "d":
						mv[0] = -DIST;
						break;
					case "a":
						mv[0] = DIST;
						break;
				}
				const worldmv = Kolu.Mat.transform(Kolu.Mat.rot(scene.cam.rot), mv);

				const m = (wm) => {
					if (Kolu.Vec.norm(wm) < 1) return;
					scene.cam.pos = Kolu.Vec.vAdd(scene.cam.pos, wm);
					requestAnimationFrame(() => m(Kolu.Vec.mul(wm, DECAY)));
				};
				m(worldmv);
			};

			const ns = [...Array(cubes.length)].map(() => Math.random() * 50);
			const a = [...Array(cubes.length)].map(() => Math.random());
			const b = [...Array(cubes.length)].map(() => Math.random());
			const rotCube = (timestamp) => {
				for (let i = 0; i < cubes.length; i++) {
					const n = timestamp / ns[i];
					cubes[i].setTransform(Kolu.Mat.rot([n * a[i], n * b[i], 0], { deg: true }));
				}
				requestAnimationFrame(rotCube);
			};
			requestAnimationFrame(rotCube);

			const main = () => {
				render();
				requestAnimationFrame(main);
			};
			main();
		</script>
	</body>
</html>
